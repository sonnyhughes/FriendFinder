<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Survey</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        
        <div class="jumbotron">
            <h1 class="text-center">
                <span class="glyphicon glyphicon-sunglasses"></span> Friend Finder</h1>
            <hr>
            <br>
            <div class="text-center">
                <a href="/">
                    <button type="button" class="btn btn-lg btn-default">
                        <span class="glyphicon glyphicon-home"></span> Home</button>
                </a>
                <a href="/api/theList">
                    <button type="button" class="btn btn-lg btn-success">
                        <span class="glyphicon glyphicon-list-alt"></span> View Friends</button>
                </a>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-12">
                <!-- Reservation Page -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Friend Survey</h4>
                    </div>
                    <div class="panel-body">
                        <form role="form">
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">Name (required)</label>
                                <input type="text" class="form-control" id="username">
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">Photo Image URL (required)</label>
                                <input type="text" class="form-control" id="userphoto">
                            </div>
                            
                            <h4>On a scale of 1 to 5, please indicate you answers below : </h4>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You like to be engaged in an active and fast-paced job:</label>
                                <select id="a0" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You are inclined to rely more on improvisation than on prior planning:</label>
                                <select id="a1" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You trust reason rather than feelings:</label>
                                <select id="a2" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You prefer to act immediately rather than speculate about various options:</label>
                                <select id="a3" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You feel that the world is founded on compassion:</label>
                                <select id="a4" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You are almost never late for your appointments:</label>
                                <select id="a5" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">After prolonged socializing you feel you need to get away and be alone:</label>
                                <select id="a6" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">Often you prefer to read a book than go to a party:</label>
                                <select id="a7" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You prefer to gain knowledge through hands-on experience than from books:</label>
                                <select id="a8" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                            <div class="form-group col-lg-6 col-md-6">
                                <label for="">You find it difficult to talk about your feelings:</label>
                                <select id="a9" class="form-control">
                                    <option>1 (No)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Yes)</option>
                                </select>
                            </div>
                        </form>
                        <button class="btn btn-primary theButton">Submit</button>
                    </div>
                </div>
                <div class="thePopup" style="position: absolute;display: none; margin-top: -40%; margin-left: 15%; background-color: white; padding: 100px; border: 5px solid black; border-radius: 25px;">
                    <h1 class="popupText"></h1>
                    <span class="popupImage"></span>
                </div>
            </div>
        </div>
        
        <footer class="footer">
            <div class="container">
                <p>
                    <a href="/api/theList">API Friends</a> |
                    <a href="https://github.com/sonnyhughes/FriendFinder">GitHub</a>
                </p>
            </div>
        </footer>

    </div>
</body>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">

    function displayPopup(htmldata, urldata) {
        $(".popupText").text(htmldata);
        $('.popupImage').html(urldata);
        $(".thePopup").show(500, function () {
            timeoutID = window.setTimeout(hideDiv, 5000);

            function hideDiv() {
                $(".thePopup").hide(500);
            };
        });
    };

    $(".theButton").on("click", function () {
        // GRAB THE FORM VALUES
        var newFriend = {
            userName: $('#username').val().trim(),
            userPhoto: $('#userphoto').val().trim(),
            userScore: []
        };
        // LOOPS THROUGH USERSCORE FOR EACH QUESTION AND PUSHES INTO NEW FRIEND OBJECT
        for (i = 0; i < 10; i++) {
            var newVal = $('#a' + i).val();
            newFriend.userScore.push(parseInt(newVal));
        }

        // GRABS THE PAGE URL
        var currentURL = window.location.origin;
        // PASSES URL AND NEW FRIEND OBJECT INTO FUNCTION, CALLBACK IS SERVER RESPONSE FROM apiRoutes.js
        $.post(currentURL + "/api/theList", newFriend,
            function (data) {
                var sendTheMatch = `Your Best match is ${data.userName}`;
                var sendTheImage = `<img src = "${data.userPhoto}">`;
                
                // DIPLAYS MODAL WINDOW
                displayPopup(sendTheMatch, sendTheImage);
                
                // CLEAR THE FORM WHEN SUBMITTING
                $('#username').val("");
                $('#userphoto').val("");
            });

        event.preventDefault();
    });
    
</script>